document.addEventListener('DOMContentLoaded', ()=>{ const user = getUser(); if(!user){ window.location.href='/index.html'; return; } document.getElementById('userLabel').textContent = user.name; document.getElementById('logoutBtn').addEventListener('click', ()=>{ localStorage.clear(); window.location.href='/index.html'; }); const alerts = document.getElementById('alerts'); const tbody = document.getElementById('unitsTbody'); async function loadUnits(){ try{ const data = await apiFetch('/units'); tbody.innerHTML=''; data.forEach(u=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td class="py-2">${u._id}</td><td class="py-2">${u.name}</td><td class="py-2">${u.location||''}</td><td class="py-2">${u.status}</td><td class="py-2">${(getUser().role==='admin')?`<button data-id=\'${u._id}\' class=\'delU\'>Delete</button>`:''}</td>`; tbody.appendChild(tr); }); document.querySelectorAll('.delU').forEach(b=>b.addEventListener('click', async ()=>{ if(!confirm('Delete unit?')) return; try{ await apiFetch('/units/'+b.dataset.id,{ method:'DELETE' }); showAlert(alerts,'Deleted'); loadUnits(); }catch(e){ showAlert(alerts,e.message,'error'); } })); }catch(e){ showAlert(alerts,e.message,'error'); } } document.getElementById('unitForm').addEventListener('submit', async e=>{ e.preventDefault(); if(getUser().role!=='admin') return showAlert(alerts,'Only admin can add units','error'); const f=e.target; try{ await apiFetch('/units',{ method:'POST', body: JSON.stringify({ name: f.name.value, location: f.location.value, status: f.status.value }) }); showAlert(alerts,'Unit added'); f.reset(); loadUnits(); }catch(e){ showAlert(alerts,e.message,'error'); } }); loadUnits(); });
